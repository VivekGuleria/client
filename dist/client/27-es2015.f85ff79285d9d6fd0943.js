(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{"h4/j":function(t,e,n){"use strict";n.r(e),n.d(e,"SettlementsModule",(function(){return X}));var i=n("SVse"),c=n("s7LF"),a=n("iInd"),s=n("wd/R"),o=n("XNiG"),r=n("orU0"),l=n("nYR2"),u=n("8Y7J"),d=n("IheW"),m=n("qfBg");let h=(()=>{class t{constructor(t,e){this.http=t,this.userService=e,this.http.get("assets/config/config.prod.json").subscribe(t=>{this.userService.changeUrl(t)})}searchSettlement(t,e,n){return this.http.post(`${this.userService.urlValue.url}/api/settlements/instructions?limit=${t}&offset=${e}`,n)}reportData(t){return this.http.post(this.userService.urlValue.url+"/api/mms-translog/report",t)}}return t.\u0275fac=function(e){return new(e||t)(u.fc(d.b),u.fc(m.a))},t.\u0275prov=u.Rb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var p=n("OC8m"),f=n("Iab2"),b=n("EUZL");let g=(()=>{class t{constructor(){}exportAsExcelFile(t,e,n){for(var i=0;i<t.length;i++)t[i].transmissionDateTime=new Date(t[i].transmissionDateTime).toLocaleString();const c=b.utils.json_to_sheet(t),a=b.write({Sheets:{data:c},SheetNames:["data"]},{bookType:"xlsx",type:"array"});this.saveAsExcelFile(a,e,n)}saveAsExcelFile(t,e,n){const i=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});f.saveAs(i,e+n+" "+s().format("YYYY-MM-DD HH:mm:ss")+".csv")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=u.Rb({token:t,factory:t.\u0275fac}),t})();var v=n("mmCC"),I=n("LqlI");let O=(()=>{class t{constructor(t,e){this.http=t,this.userService=e,this.http.get("assets/config/config.prod.json").subscribe(t=>{this.userService.changeUrl(t)})}getDetails(t){return this.http.post(this.userService.urlValue.url+"/api/settlements/details",t)}}return t.\u0275fac=function(e){return new(e||t)(u.fc(d.b),u.fc(m.a))},t.\u0275prov=u.Rb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var S=n("kFe1"),D=n("xkgV");function y(t,e){if(1&t&&(u.bc(0,"option",21),u.Qc(1),u.ac()),2&t){const t=e.$implicit;u.uc("value",t.id),u.Ib(1),u.Tc("",t.id," ",t.name," ")}}const w=function(){return{standalone:!0}};function x(t,e){if(1&t){const t=u.cc();u.bc(0,"div",10),u.bc(1,"label",7),u.Qc(2,"Merchant ID"),u.ac(),u.bc(3,"select",19),u.jc("ngModelChange",(function(e){return u.Ic(t),u.nc().merchantId=e})),u.Oc(4,y,2,3,"option",20),u.ac(),u.ac()}if(2&t){const t=u.nc();u.Ib(3),u.uc("ngModelOptions",u.xc(3,w))("ngModel",t.merchantId),u.Ib(1),u.uc("ngForOf",t.merchData)}}function C(t,e){if(1&t&&(u.bc(0,"span"),u.Qc(1),u.ac()),2&t){const t=u.nc().$implicit;u.Ib(1),u.Sc(" ",t.label," \xa0 ")}}function T(t,e){if(1&t&&(u.bc(0,"span"),u.Qc(1),u.ac()),2&t){const t=u.nc().$implicit;u.Ib(1),u.Rc(t.label)}}function A(t,e){if(1&t&&(u.bc(0,"span"),u.Qc(1),u.ac()),2&t){const t=u.nc().$implicit;u.Ib(1),u.Rc(t.label)}}function M(t,e){if(1&t&&(u.bc(0,"th"),u.Zb(1,24),u.Oc(2,C,2,1,"span",25),u.Oc(3,T,2,1,"span",25),u.Oc(4,A,2,1,"span",25),u.Yb(),u.ac()),2&t){const t=e.$implicit,n=u.nc(2);u.Ib(1),u.uc("ngSwitch",t.field),u.Ib(1),u.uc("ngIf","Tip Amount"!=t.label&&"Total Amount"!=t.label),u.Ib(1),u.uc("ngIf","Tip Amount"==t.label&&!n.isSynefo&&n.tipEnable),u.Ib(1),u.uc("ngIf","Total Amount"==t.label&&!n.isSynefo&&n.tipEnable)}}function P(t,e){if(1&t&&(u.bc(0,"div"),u.Qc(1),u.ac()),2&t){const t=u.nc().$implicit,e=u.nc().$implicit;u.Ib(1),u.Rc(e[t.field])}}function F(t,e){if(1&t&&(u.bc(0,"div"),u.Qc(1),u.oc(2,"date"),u.ac()),2&t){const t=u.nc().$implicit,e=u.nc().$implicit;u.Ib(1),u.Rc(u.qc(2,1,1e3*e[t.field],"dd/MM/yyyy h:mma"))}}function k(t,e){1&t&&(u.bc(0,"div"),u.Qc(1,"---"),u.ac())}function Q(t,e){if(1&t&&(u.bc(0,"span"),u.Qc(1),u.oc(2,"number"),u.ac()),2&t){const t=u.nc(2).$implicit;u.Ib(1),u.Rc(u.qc(2,1,t.grossAmount,"1.2-2"))}}function R(t,e){if(1&t&&(u.bc(0,"span"),u.Qc(1),u.oc(2,"number"),u.ac()),2&t){const t=u.nc(2).$implicit;u.Ib(1),u.Rc(u.qc(2,1,t.totalTipAmount,"1.2-2"))}}function E(t,e){if(1&t&&(u.bc(0,"span"),u.Qc(1),u.oc(2,"number"),u.ac()),2&t){const t=u.nc(2).$implicit;u.Ib(1),u.Rc(u.qc(2,1,t.totalAmountWithTip,"1.2-2"))}}function L(t,e){1&t&&(u.bc(0,"span",28),u.Qc(1,"Initiated"),u.ac())}function $(t,e){1&t&&(u.bc(0,"span",29),u.Qc(1,"Settled"),u.ac())}function _(t,e){if(1&t&&(u.bc(0,"span"),u.Qc(1),u.oc(2,"slice"),u.oc(3,"slice"),u.oc(4,"slice"),u.ac()),2&t){const t=u.nc(2).$implicit;u.Ib(1),u.Uc("",u.rc(2,3,t.settlementDate,8,10),"/",u.rc(3,7,t.settlementDate,5,7),"/",u.rc(4,11,t.settlementDate,0,4),"")}}function V(t,e){if(1&t&&(u.bc(0,"td"),u.Oc(1,P,2,1,"div",25),u.Oc(2,F,3,4,"div",25),u.Oc(3,k,2,0,"div",25),u.Oc(4,Q,3,4,"span",25),u.Oc(5,R,3,4,"span",25),u.Oc(6,E,3,4,"span",25),u.Oc(7,L,2,0,"span",26),u.Oc(8,$,2,0,"span",27),u.Oc(9,_,5,15,"span",25),u.ac()),2&t){const t=e.$implicit,n=u.nc().$implicit,i=u.nc(2);u.Ib(1),u.uc("ngIf","createdDateTime"!=t.field&&"grossAmount"!==t.field&&"totalTipAmount"!==t.field&&"totalAmountWithTip"!==t.field&&"status"!==t.field&&"settlementDate"!==t.field),u.Ib(1),u.uc("ngIf","createdDateTime"==t.field),u.Ib(1),u.uc("ngIf",null==n[t.field]&&"status"!=t.field&&"totalTipAmount"!==t.field&&"totalAmountWithTip"!==t.field),u.Ib(1),u.uc("ngIf","grossAmount"===t.field),u.Ib(1),u.uc("ngIf","totalTipAmount"===t.field&&!i.isSynefo&&i.tipEnable),u.Ib(1),u.uc("ngIf","totalAmountWithTip"===t.field&&!i.isSynefo&&i.tipEnable),u.Ib(1),u.uc("ngIf","status"===t.field&&null===n.utr),u.Ib(1),u.uc("ngIf","status"===t.field&&null!==n.utr),u.Ib(1),u.uc("ngIf","settlementDate"===t.field&&null!==n.settlementDate)}}function j(t,e){if(1&t&&(u.bc(0,"tr"),u.Oc(1,V,10,9,"td",23),u.ac()),2&t){const t=u.nc(2);u.Ib(1),u.uc("ngForOf",t.cols)}}const N=function(t,e,n){return{itemsPerPage:t,currentPage:e,totalItems:n}};function W(t,e){if(1&t&&(u.bc(0,"table",22),u.bc(1,"thead"),u.bc(2,"tr"),u.Oc(3,M,5,4,"th",23),u.ac(),u.ac(),u.bc(4,"tbody"),u.Oc(5,j,2,1,"tr",23),u.oc(6,"paginate"),u.ac(),u.ac()),2&t){const t=u.nc();u.Ib(3),u.uc("ngForOf",t.cols),u.Ib(2),u.uc("ngForOf",u.qc(6,2,t.dummyData,u.Ac(5,N,t.itemsPerPage,t.page,t.count)))}}function q(t,e){1&t&&(u.bc(0,"h4",30),u.Qc(1,"No data found !"),u.ac())}function U(t,e){if(1&t){const t=u.cc();u.bc(0,"div",38),u.jc("click",(function(){u.Ic(t);const n=e.$implicit;return u.nc(2).itemOnPage(n)})),u.Qc(1),u.ac()}if(2&t){const t=e.$implicit,n=u.nc(2);u.uc("ngClass",n.itemsPerPage==t?"item-number-active":"item-number"),u.Ib(1),u.Sc(" ",t," ")}}function B(t,e){if(1&t&&(u.bc(0,"span",39),u.Qc(1),u.ac()),2&t){const t=u.nc(2);u.Ib(1),u.Sc("Total Amount-",t.amount," ")}}function H(t,e){if(1&t&&(u.bc(0,"span",39),u.Qc(1),u.ac()),2&t){const t=u.nc(2);u.Ib(1),u.Sc(" Total Count-",t.count,"")}}function z(t,e){if(1&t){const t=u.cc();u.bc(0,"div",31),u.bc(1,"div",5),u.bc(2,"div",32),u.bc(3,"span",33),u.Qc(4," Show "),u.ac(),u.Oc(5,U,2,2,"div",34),u.bc(6,"span",33),u.Qc(7," entries per page "),u.ac(),u.ac(),u.bc(8,"div",35),u.Oc(9,B,2,1,"span",36),u.Wb(10,"br"),u.Oc(11,H,2,1,"span",36),u.bc(12,"pagination-controls",37),u.jc("pageChange",(function(e){return u.Ic(t),u.nc().pageChanged(e)})),u.ac(),u.ac(),u.ac(),u.ac()}if(2&t){const t=u.nc();u.Ib(5),u.uc("ngForOf",t.entriesOnPage),u.Ib(4),u.uc("ngIf",t.amount),u.Ib(2),u.uc("ngIf",t.count)}}const Y=[{path:"",component:(()=>{class t{constructor(t,e,n,i,c,a,o,l){this.formBuilder=t,this.settlementService=e,this.notificationService=n,this.excelService=i,this.userService=c,this.transactionService=a,this.modalService=o,this.detailsService=l,this.title="angular-ngx-daterangepicker-material-app",this.formSubmitted=!1,this.roleAccess=r.a,this.selected={startDate:s("00:00","HH:mm").subtract(10,"days"),endDate:s("23:59","HH:mm")},this.detailss=[],this.loading=!1,this.isSynefo=!1,this.tipEnable=!1,this.cols=[{label:"Beneficiary ID",field:"beneficiaryID",sortOptions:"",sort:"text"},{label:"Settlement Date",field:"settlementDate",sortOptions:"",sort:"number"},{label:"Gross Amount",field:"grossAmount",sortOptions:"",sort:"number"},{label:"Tip Amount",field:"totalTipAmount",sortOptions:"",sort:"number"},{label:"Total Amount",field:"totalAmountWithTip",sortOptions:"",sort:"number"},{label:"Other Adjustments",field:"adjustments",sortOptions:"",sort:"number"},{label:"Net Amount Settled",field:"totalNetAmountToBePaid",sortOptions:"",sort:"number"},{label:"Transaction Charges",field:"totalTxnCharges",sortOptions:"",sort:"number"},{label:"Service Tax",field:"totalServiceTax",sortOptions:"",sort:"number"},{label:"Other Deduction",field:"deduction",sortOptions:"",sort:"number"},{label:"UTR No",field:"utr",sortOptions:"",sort:"number"},{label:"Status",field:"status",sortOptions:"",sort:"text"}],this.numberSortOptions=[{name:"Sort 0 to 9",value:"ASC",img:"a-z"},{name:"Sort 9 to 0",value:"DESC",img:"z-a"}],this.offset=0,this.dummyData=[],this.reportData=[],this.itemsPerPage=10,this.page=1,this.entriesOnPage=[5,10,15,20],this.searchCriteria={},this.ranges={Today:[s(),s()],"Last 7 Days":[s().subtract(6,"days"),s()],"Last 30 Days":[s().subtract(29,"days"),s()],"Last 3 Month":[s().subtract(3,"month").startOf("month"),s().subtract(1,"month").endOf("month")],"Last 6 Months":[s().subtract(6,"month").startOf("month"),s().subtract(1,"month").endOf("month")]},this.textSortOptions=[{name:"Sort A to Z",value:"ASC",img:"a-z"},{name:"Sort Z to A",value:"DESC",img:"z-a"}]}ngOnInit(){this.loggedInUser=this.userService.userValue,this.tipEnable=this.userService.userValue.tipEnabled,this.merchantIds=["ALL"].concat(this.userService.userValue.merchantIds),this.merchantId="ALL",this.merchData=this.userService.userValue.merchants,this.IsSynefoMerchant(),this.createForm(),this.search(!1),this.onClose=new o.a}createForm(){this.searchForm=this.formBuilder.group({searchDate:["",[c.y.required]],utrN:["",[c.y.required]],merchantID:["",c.y.required]})}pageChanged(t){this.page=t,this.search(!1)}itemOnPage(t){this.page=0,this.itemsPerPage=t,this.search(!1)}setSortOption(t,e){this.cols.forEach(n=>{t===n.field&&(n.sortOptions=e,this.selectedSortOption=e)})}sortingClick(t){this.sortField=this.selectedField,this.customSort({field:this.selectedField,order:"ASC"===t?1:-1,data:this.dummyData})}customSort(t){this.sortField.length>0&&(t.data&&t.data.sort((e,n)=>{let i=e[t.field],c=n[t.field],a=null;return a=null==i&&null!=c?-1:null!=i&&null==c?1:null==i&&null==c?0:"string"==typeof i&&"string"==typeof c?i.localeCompare(c):i<c?-1:i>c?1:0,t.order*a}),this.sortField="")}search(t){let e,n;1==t&&(this.page=1),null==this.searchForm.value.searchDate.startDate&&null==this.searchForm.value.searchDate.endDate?(e=this.selected.startDate,n=this.selected.endDate):(e=this.searchForm.value.searchDate.startDate,n=this.searchForm.value.searchDate.endDate);const i=new Date(e).getTime()/1e3,c=new Date(n).getTime()/1e3;let a=this.page;this.page>0&&(a=this.page-1),this.settlementService.searchSettlement(this.itemsPerPage,a,{fromDate:i,toDate:c,fromTime:"00:00",toTime:"23:59",utr:this.searchForm.value.utrN,merchantId:this.merchantId?this.merchantId:this.userService.userValue.merchantIds,merchantType:this.userService.userValue.merchantType}).subscribe(t=>{this.dummyData=t.data,this.count=t.count,this.amount=t.totalAmount,this.filterSettlementDetails()})}downloadReport(t,e){let n={settlementBatchNo:t};this.merchId=e,this.settlementService.reportData(n).subscribe(t=>{this.reportData=t,this.reportData.length>0?this.excelService.exportAsExcelFile(this.reportData,"SettlementReport",this.merchId):this.notificationService.showInfo("No data found for this settlement batch no.","")})}getMerchantList(){this.transactionService.merchantList({merchantid:this.loggedInUser.merchantId}).subscribe(t=>{this.merchantList=t,console.log(t)},t=>{console.log(t)})}IsSynefoMerchant(){this.transactionService.dropdownList().subscribe(t=>{var e;this.isSynefo=null===(e=t)||void 0===e?void 0:e.isSynefoMerchant})}oopenModal(t,e){console.log(e),this.loading=!0,this.detailss={},this.modalRef=this.modalService.show(t,{class:"modal-xl"}),this.detailsService.getDetails({settlementBatchNo:e}).pipe(Object(l.a)(()=>this.loading=!1)).subscribe(t=>{this.detailss=t})}filterSettlementDetails(){for(let t=0;t<this.dummyData.length;t++)this.dummyData[t]=Object.assign(Object.assign({},this.dummyData[t]),this.dummyData[t].settlementDetails)}}return t.\u0275fac=function(e){return new(e||t)(u.Vb(c.c),u.Vb(h),u.Vb(p.a),u.Vb(g),u.Vb(m.a),u.Vb(v.a),u.Vb(I.b),u.Vb(O))},t.\u0275cmp=u.Pb({type:t,selectors:[["app-settlements"]],decls:26,vars:16,consts:[[1,"container-fluid","p-0",2,"height","100vh"],[1,"row","box","mt-3"],[1,"col-md-12","card-header",2,"font-weight","700"],[1,"icon-speedometer","ml-2",2,"font-weight","700"],[1,"col-md-12",3,"formGroup"],[1,"row"],[1,"col-md-5","p-4","mr-2"],[2,"font-weight","500"],["id","calendar-input","type","text","ngxDaterangepickerMd","",1,"form-control",3,"formControl","dateLimit","ngModel","autoApply","showCustomRangeLabel","alwaysShowCalendars","timePicker","timePicker24Hour","ranges","linkedCalendars","keepCalendarOpeningWithRange","ngModelChange"],["id","icon","for","calendar-input",1,"date-range-picker-icon","fa","fa-calendar"],[1,"col-md-2","p-4"],["type","text","formControlName","utrN",1,"form-control"],["class","col-md-2 p-4",4,"ngIf"],[1,"col-md-2","mt-5"],[1,"btn",2,"background-color","rgb(49, 179, 230)","color","white",3,"click"],[1,"col-md-12",2,"overflow-x","scroll"],["class","table table-striped table-hover table-responsive-lg",4,"ngIf","ngIfElse"],["other_content",""],["class","container-fluid mt-3",4,"ngIf"],["ngDefaultControl","",1,"custom-select","mb-2","mr-sm-2","mb-sm-0",3,"ngModelOptions","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"table","table-striped","table-hover","table-responsive-lg"],[4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngIf"],["class","badge badge-warning text-white",4,"ngIf"],["class","badge badge-success",4,"ngIf"],[1,"badge","badge-warning","text-white"],[1,"badge","badge-success"],[1,"p-4",2,"text-align","center","color","lightgray"],[1,"container-fluid","mt-3"],[1,"col-md-4","d-inline-flex"],[1,"p-2",2,"font-weight","700","color","lightslategray"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"col-md-8","myDiv1"],["style","font-weight: 700;  color: lightslategray;padding-left: 150px;",4,"ngIf"],[1,"float-right","mDiv",3,"pageChange"],[3,"ngClass","click"],[2,"font-weight","700","color","lightslategray","padding-left","150px"]],template:function(t,e){if(1&t&&(u.bc(0,"div",0),u.bc(1,"div",1),u.bc(2,"div",2),u.Wb(3,"i",3),u.Qc(4,"SETTLEMENTS "),u.ac(),u.bc(5,"form",4),u.bc(6,"div",5),u.bc(7,"div",6),u.bc(8,"label",7),u.Qc(9,"Duration:"),u.ac(),u.bc(10,"input",8),u.jc("ngModelChange",(function(t){return e.selected=t})),u.ac(),u.Wb(11,"label",9),u.ac(),u.bc(12,"div",10),u.bc(13,"label",7),u.Qc(14,"UTR No."),u.ac(),u.Wb(15,"input",11),u.ac(),u.Oc(16,x,5,4,"div",12),u.bc(17,"div",13),u.bc(18,"button",14),u.jc("click",(function(){return e.search(!0)})),u.Qc(19,"Search"),u.ac(),u.ac(),u.ac(),u.ac(),u.ac(),u.bc(20,"div",1),u.bc(21,"div",15),u.Oc(22,W,7,9,"table",16),u.Oc(23,q,2,0,"ng-template",null,17,u.Pc),u.ac(),u.Oc(25,z,13,3,"div",18),u.ac(),u.ac()),2&t){const t=u.Fc(24);u.Ib(5),u.uc("formGroup",e.searchForm),u.Ib(5),u.uc("formControl",e.searchForm.controls.searchDate)("dateLimit",90)("ngModel",e.selected)("autoApply",!1)("showCustomRangeLabel",!1)("alwaysShowCalendars",!0)("timePicker",!0)("timePicker24Hour",!0)("ranges",e.ranges)("linkedCalendars",!0)("keepCalendarOpeningWithRange",!0),u.Ib(6),u.uc("ngIf","AGG"===e.loggedInUser.merchantType),u.Ib(6),u.uc("ngIf",e.dummyData.length>0)("ngIfElse",t),u.Ib(3),u.uc("ngIf",e.dummyData.length>0)}},directives:[c.A,c.o,c.h,S.a,c.b,c.n,c.e,c.f,i.n,c.x,c.q,i.m,c.r,c.z,i.p,D.c,i.l],pipes:[D.b,i.e,i.f,i.v],styles:[".bnt[_ngcontent-%COMP%]{font-size:14px}.box[_ngcontent-%COMP%]{background-color:#fff}.item-number[_ngcontent-%COMP%], .item-number-active[_ngcontent-%COMP%]{display:inline-block;border:1px solid hsla(0,0%,50.2%,.7);padding-left:9px;padding-right:9px;padding-top:2px;height:30px;cursor:pointer;margin:1px}.item-number-active[_ngcontent-%COMP%]{background-color:#2199e8;color:#fff}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{text-align:center}td[_ngcontent-%COMP%]{padding:5px}.dropdown-menu[_ngcontent-%COMP%]{min-width:0}.show-data[_ngcontent-%COMP%]{overflow-x:scroll}#icon[_ngcontent-%COMP%]{float:right;margin-top:-24px;font-size:17px;padding-right:8px}  .md-drppicker{width:600px!important}th[_ngcontent-%COMP%]{border-top:none;white-space:nowrap;padding:.4rem}.modal-body[_ngcontent-%COMP%]{overflow-x:scroll;padding:3px!important}.modal-header[_ngcontent-%COMP%]{background-color:#f2f2f2}.mDiv[_ngcontent-%COMP%]{margin-top:-20px}@media screen and (min-width:700px) and (max-width:1384px){.mDiv[_ngcontent-%COMP%]{margin-top:-40px;margin-left:300px}.myDiv1[_ngcontent-%COMP%]{float:right}}"]}),t})()}];let G=(()=>{class t{}return t.\u0275mod=u.Tb({type:t}),t.\u0275inj=u.Sb({factory:function(e){return new(e||t)},imports:[[a.g.forChild(Y)],a.g]}),t})();var Z=n("FE24"),J=n("d2mR");let X=(()=>{class t{}return t.\u0275mod=u.Tb({type:t}),t.\u0275inj=u.Sb({factory:function(e){return new(e||t)},providers:[g,I.a,I.b],imports:[[i.c,c.i,J.a,G,D.a,Z.c,c.v,S.b.forRoot()]]}),t})()}}]);